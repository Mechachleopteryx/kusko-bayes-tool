---
title: "Historical Data For Bayes' Tool"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = F, warning = F)
```

```{r read data}
library(reshape2)
library(dplyr)
library(pander)
panderOptions(o = "table.split.table", value = Inf) # set global table option to never break table on two rows

hist_dat = read.csv("HistExampleData.csv", stringsAsFactors = F)
hist_dat$trueN = round(hist_dat$trueN, -3)
hist_dat$fcstN = round(hist_dat$fcstN, -3)
hist_dat$maxH = hist_dat$trueN - 65000; hist_dat$maxH = ifelse(hist_dat$maxH < 0, 0, hist_dat$maxH)
hist_dat$midH = hist_dat$trueN - 92500; hist_dat$midH = ifelse(hist_dat$midH < 0, 0, hist_dat$midH)
hist_dat$minH = hist_dat$trueN - 120000; hist_dat$minH = ifelse(hist_dat$minH < 0, 0, hist_dat$minH)


prettify = function(x, rnd = NULL) {
  if (!is.null(rnd)) x = round(x, rnd)
  out = prettyNum(x = x, big.mark = ",", scientific = F)
  
  return(out)
}
```


This information is intended to be used to illustrate how the Bayes' Tool works by providing some example data from previous years. Hopefully it is clear where each source of information should be entered. _Do not enter data from multiple years at once._

**NOTE:** 

*  Harvest values are approximate.
*  For harvest CV, any values between 0.05 and 0.15 should be appropriate.
*  Commas are provided here for enhanced readibility, do not enter these in the tool.
*  Values have been rounded for simplicity.

## Values for Estimation Inputs

**TABLE 1.** Run size forecasts (mean).

```{r make table 1, results = "asis"}
hist_dat %>% select(year, date, fcstN) %>% mutate(pfcstN = prettify(x = fcstN)) %>%
  filter(date == "6/12") %>%
  dcast(date ~ year, value.var = "pfcstN") %>% 
  select(-date) %>%
  pandoc.table(style = "simple",
                       justify = c(rep("center", length(unique(hist_dat$year)))))

```

---

**TABLE 2.** BTF CCPUE at weekly intervals.

```{r make table 2, results = "asis"}
hist_dat %>% select(year, date, ccpue) %>% 
  dcast(date ~ year, value.var = "ccpue") %>% 
  rename(Date = date) %>%
  pandoc.table(style = "simple", emphasize.strong.cols = 1,
                       justify = c("left", rep("center", length(unique(hist_dat$year)))))

```

---

**TABLE 3.** Cumulative harvest downstream of the BTF site at weekly intervals.

```{r make table 3, results = "asis"}
hist_dat %>% select(year, date, ds_harv) %>% mutate(pds_harv = prettify(ds_harv)) %>%
  dcast(date ~ year, value.var = "pds_harv") %>% 
  rename(Date = date) %>%
  pandoc.table(style = "simple", emphasize.strong.cols = 1,
                       justify = c("left", rep("center", length(unique(hist_dat$year)))))

```

---

## Values for Risk Analysis Inputs
**TABLE 4.** Total cumulative harvest taken at weekly intervals.

```{r make table 4, results = "asis"}
hist_dat %>% select(year, date, harv) %>% mutate(pharv = prettify(harv)) %>%
  dcast(date ~ year, value.var = "pharv") %>% 
  rename(Date = date) %>%
  pandoc.table(style = "simple", emphasize.strong.cols = 1,
                       justify = c("left", rep("center", length(unique(hist_dat$year)))))
```

## Values for Reference

**TABLE 5.** True total run size.

```{r make table 5, results = "asis"}
hist_dat %>% select(year, date, trueN) %>% mutate(ptrueN = prettify(x = trueN)) %>%
  filter(date == "6/12") %>%
  dcast(date ~ year, value.var = "ptrueN") %>% 
  select(-date) %>%
  pandoc.table(style = "simple",
                       justify = c(rep("center", length(unique(hist_dat$year)))))

```

**TABLE 6.** The appropriate level of harvest that could have been taken if managers targetted various points within the escapement goal range.

*  **Minimum Harvest**: The harvest that would have resulted in escapement being exactly 120,000 (the upper bound of the SEG).
*  **Medium Harvest**: The harvest that would have resulted in escapement being exactly 92,500 (the midpoint of the SEG).
*  **Maximum Harvest**: The harvest that would have resulted in escapement being exactly 65,000 (the lower bound of the SEG).

```{r, results = "asis"}
minH = hist_dat %>% select(year, date, minH) %>% mutate(pminH = prettify(minH)) %>%
  filter(date == "6/12") %>%
  dcast(date ~ year, value.var = "pminH") %>% 
  select(-date) 
midH = hist_dat %>% select(year, date, midH) %>% mutate(pmidH = prettify(midH)) %>%
  filter(date == "6/12") %>%
  dcast(date ~ year, value.var = "pmidH") %>% 
  select(-date) 
maxH = hist_dat %>% select(year, date, maxH) %>% mutate(pmaxH = prettify(maxH)) %>%
  filter(date == "6/12") %>%
  dcast(date ~ year, value.var = "pmaxH") %>% 
  select(-date) 

tab = rbind(minH, midH, maxH)
tab = cbind("Level" = c("Minumum Harvest", "Medium Harvest", "Maximum Harvest"),
      tab)

pandoc.table(tab, style = "simple", emphasize.strong.cols = 1,
             justify = c("left", rep("center", length(unique(hist_dat$year)))))
  
  

```

